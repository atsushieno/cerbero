# -*- Mode: Python -*- vi:si:et:sw=4:sts=4:ts=4:syntax=python

class Recipe(recipe.Recipe):
    name = 'serd'
    version = '0.30.2'
    libNameVersioned = 'libserd-0.so'
    licenses = [{License.BSD_like: ['COPYING']}]
    btype = BuildType.CUSTOM
    stype = SourceType.GIT
    remotes = {'origin': 'https://github.com/atsushieno/serd.git'}
    commit = 'd393787'

    def configure(self):
        shell.call ('cd ' + self.build_dir + ' && LDFLAGS="$LDFLAGS -landroid -Wl,-soname,' + self.libNameVersioned + '" ./waf configure -d --no-utils --prefix=' + self.config.prefix)

    def install(self):
        shell.call ('cd ' + self.build_dir + ' && ./waf build install')
        # remove symbolic links
        shell.call ('cd ' + os.path.join(self.config.prefix, 'lib') + ' && cp ' + self.libNameVersioned + ' _tmp.so && rm ' + self.libNameVersioned + '.* && mv _tmp.so ' + self.libNameVersioned)

    def clean(self):
        shell.call ('cd ' + self.build_dir + ' && ./waf clean')

